根据我的描述来帮我生成一个完整的mermaid图：
1. web端使用
创建topic流程
- 用户可以在web端创建topic，后端topic_service可以将topic写入数据库并返回成功

删除topic
- 用户可以在web端删除topic，后端topic_service可以将topic从数据库中删除并返回成功

查看topic
- 用户可以在web端查看topic，后端topic_service可以将topic从数据库中查询并返回. 

上传文件：
- 用户可以在一个topic下上传文件
- 上传完成后前端会请求 confirm接口，确认文件上传完成，文件状态变成processing
- 确认完成后会发送一个确认事件
- 确认事件会存储到redis中
- 确认事件完成，异步任务会开始执行，并 发送rag处理事件
- rag处理会对文档进行分片+embedding生成 + 摘要生成 + 关键词提取
- 事件处理后会更新文件状态为available


用户chat：
- 用户在web端可以在一个topic下进行chat， 发送query后，后端chat_service会进行处理
- chat_service会先对问题进行意图识别+query路由
- 如果是摘要类型，会调用summary_service进行处理
- 如果是详细问题，会调用rag_service进行处理
- 如果是系统类型，会调用system_service进行处理
- 如果是工具类型，会调用tool_service进行处理
- 如果是聊天类型，会调用chat_service进行处理
- 如果是其他类型，会调用其他服务进行处理
- 处理完成后会返回结果给前端
- 返回结果给前端后，前端会更新聊天记录
- 聊天会流式返回结果给前端、
- 聊天内容会存到elasticsearch中


rag处理部分：
- 文件会从storage中加载到临时目录
- 文件会进行分片处理
- 分片处理后会进行embedding生成
- 分片embedding生成后会进行向量存储 （存到document collection中） + 将内容递归总结存到summary collection中
- 向量存储后会进行语义搜索


chat部分：
- query会由不同的路由策略进行处理
- 如果是摘要类型，会调用summary_service进行处理
- 如果是详细问题，会调用rag_service进行处理
- 如果是系统类型，会调用system_service进行处理
- 如果是工具类型，会调用tool_service进行处理
- 如果是聊天类型，会调用chat_service进行处理
- 如果是其他类型，会调用其他服务进行处理


2. CLI端使用
CLI端使用：
- 用户可以通过命令行工具与系统交互，支持topic管理、文件上传、聊天等功能
- 支持命令：创建topic、删除topic、查看topic列表、上传文件到指定topic、发起chat会话
- 上传文件后可通过命令确认文件上传，系统会异步处理文件（分片、embedding、摘要、关键词提取）
- 用户可在CLI中输入query，系统会自动进行意图识别和路由，调用相应的服务（如summary、rag、chat等）
- 聊天结果会在命令行中流式输出
- 支持查看历史聊天记录
- 所有操作均有详细的命令行提示和结果反馈




