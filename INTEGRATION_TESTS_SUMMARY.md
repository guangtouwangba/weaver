# é›†æˆæµ‹è¯•å®æ–½æ€»ç»“

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

âœ… **å·²å®Œæˆçš„å·¥ä½œ**ï¼š

### 1. æµ‹è¯•æ¶æ„è®¾è®¡
- åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•ç›®å½•ç»“æ„
- å»ºç«‹äº†pytesté…ç½®å’Œfixtureç³»ç»Ÿ
- è®¾è®¡äº†çœŸå®æ•°æ®åº“æµ‹è¯•ç¯å¢ƒ

### 2. APIå±‚é›†æˆæµ‹è¯•
- **ä¸»é¢˜APIæµ‹è¯•** (`test_topics_api.py`): 11ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰CRUDæ“ä½œ
- **æ–‡ä»¶APIæµ‹è¯•** (`test_files_api.py`): 12ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬ç­¾åURLä¸Šä¼ å’Œç›´æ¥ä¸Šä¼ 
- **æ–‡æ¡£APIæµ‹è¯•** (`test_documents_api.py`): 12ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬æ–‡æ¡£å¤„ç†å’Œæœç´¢
- **èµ„æºAPIæµ‹è¯•** (`test_resources_api.py`): 10ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ¶µç›–èµ„æºç®¡ç†

### 3. æ•°æ®åº“é›†æˆæµ‹è¯•
- **æ•°æ®åº“å±‚æµ‹è¯•** (`test_database.py`): 8ä¸ªæµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•æ‰€æœ‰æ•°æ®æ¨¡å‹çš„CRUDæ“ä½œ
- éªŒè¯å…³ç³»å’Œçº¦æŸ
- æµ‹è¯•äº‹åŠ¡å’Œæ‰¹é‡æ“ä½œ

### 4. å…¨æ ˆé›†æˆæµ‹è¯•
- **å®Œæ•´å·¥ä½œæµæµ‹è¯•** (`test_full_stack.py`): 4ä¸ªç»¼åˆæµ‹è¯•
- ç«¯åˆ°ç«¯çŸ¥è¯†ç®¡ç†å·¥ä½œæµ
- å¤šä¸»é¢˜äº¤å‰å¼•ç”¨æµ‹è¯•
- é”™è¯¯å¤„ç†å’Œæ¢å¤æµ‹è¯•
- åŸºæœ¬æ€§èƒ½å’Œå¹¶å‘æµ‹è¯•

### 5. æµ‹è¯•å·¥å…·å’Œé…ç½®
- è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œè„šæœ¬ (`run_integration_tests.py`)
- pytesté…ç½®æ–‡ä»¶å’Œmarkers
- æµ‹è¯•fixtureå’Œæ•°æ®åº“è®¾ç½®
- è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç”¨ä¾‹æ•° | è¦†ç›–åŠŸèƒ½ |
|---------|----------|----------|
| test_topics_api.py | 11 | ä¸»é¢˜APIå®Œæ•´CRUD + æœç´¢ |
| test_files_api.py | 12 | æ–‡ä»¶ä¸Šä¼ /ç®¡ç† + å¤šç§ä¸Šä¼ æ–¹å¼ |
| test_documents_api.py | 12 | æ–‡æ¡£åˆ›å»º/å¤„ç† + æœç´¢/åˆ†å— |
| test_resources_api.py | 10 | èµ„æºç®¡ç† + è·¨ä¸»é¢˜å…³è” |
| test_database.py | 8 | æ•°æ®åº“æ¨¡å‹ + å…³ç³»çº¦æŸ |
| test_full_stack.py | 4 | ç«¯åˆ°ç«¯å·¥ä½œæµ + æ€§èƒ½æµ‹è¯• |
| **æ€»è®¡** | **57** | **å®Œæ•´API + æ•°æ®åº“ + å·¥ä½œæµ** |

## ğŸ—ï¸ æµ‹è¯•ç‰¹ç‚¹

### çœŸå®ç¯å¢ƒæµ‹è¯•
- âœ… ä½¿ç”¨çœŸå®PostgreSQLæ•°æ®åº“
- âœ… æ²¡æœ‰ä»»ä½•mockæ•°æ®
- âœ… æ¯ä¸ªæµ‹è¯•éƒ½ç‹¬ç«‹ä¸”å¯é‡å¤è¿è¡Œ
- âœ… å®Œæ•´çš„æ•°æ®åº“è®¾ç½®å’Œæ¸…ç†

### å…¨å±‚æ¬¡è¦†ç›–
- âœ… **APIå±‚**: æ‰€æœ‰HTTPç«¯ç‚¹æµ‹è¯•
- âœ… **æœåŠ¡å±‚**: ä¸šåŠ¡é€»è¾‘éªŒè¯
- âœ… **æ•°æ®åº“å±‚**: æ¨¡å‹å’Œå…³ç³»æµ‹è¯•
- âœ… **å·¥ä½œæµå±‚**: ç«¯åˆ°ç«¯æµç¨‹éªŒè¯

### é”™è¯¯å¤„ç†è¦†ç›–
- âœ… HTTPé”™è¯¯çŠ¶æ€ç ï¼ˆ404, 422, 500ï¼‰
- âœ… æ•°æ®éªŒè¯é”™è¯¯
- âœ… æ•°æ®åº“çº¦æŸè¿è§„
- âœ… å¹¶å‘æ“ä½œå†²çªå¤„ç†

### æ€§èƒ½éªŒè¯
- âœ… å¹¶å‘æ“ä½œæµ‹è¯•
- âœ… æ‰¹é‡æ•°æ®å¤„ç†
- âœ… å“åº”æ—¶é—´åŸºå‡†
- âœ… æ•°æ®ä¸€è‡´æ€§éªŒè¯

## ğŸ”§ å¦‚ä½•è¿è¡Œæµ‹è¯•

### å‰ææ¡ä»¶
1. **PostgreSQLæ•°æ®åº“è¿è¡Œåœ¨localhost:5432**
   - ç”¨æˆ·: `rag_user`
   - å¯†ç : `rag_password`
   - æµ‹è¯•æ•°æ®åº“: `rag_test_db`ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºï¼‰

2. **å®‰è£…Pythonæµ‹è¯•ä¾èµ–**
   ```bash
   pip install pytest pytest-asyncio httpx fastapi sqlalchemy asyncpg
   ```

### è¿è¡Œæ–¹å¼

```bash
# æ–¹å¼1: ä½¿ç”¨ä¸“ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
python tests/run_integration_tests.py

# æ–¹å¼2: ç›´æ¥ä½¿ç”¨pytest
pytest tests/integration/ -m integration -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»å‹
pytest tests/integration/ -m api -v          # åªè¿è¡ŒAPIæµ‹è¯•
pytest tests/integration/ -m database -v    # åªè¿è¡Œæ•°æ®åº“æµ‹è¯•
pytest tests/integration/ -m fullstack -v   # åªè¿è¡Œå…¨æ ˆæµ‹è¯•

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
pytest tests/integration/test_topics_api.py -v
```

### é«˜çº§é€‰é¡¹
```bash
# è¯¦ç»†è¾“å‡ºå’Œè¦†ç›–ç‡æŠ¥å‘Š
python tests/run_integration_tests.py --verbose --coverage

# è¿‡æ»¤ç‰¹å®šæµ‹è¯•
python tests/run_integration_tests.py --test-filter "test_create"

# å¹¶å‘è¿è¡Œæµ‹è¯•
pytest tests/integration/ -n auto
```

## ğŸ¯ æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### ä¸»é¢˜APIæµ‹è¯•ç¤ºä¾‹
```python
async def test_complete_topic_workflow(client, sample_topic_data):
    """æµ‹è¯•å®Œæ•´çš„ä¸»é¢˜ç®¡ç†å·¥ä½œæµ"""
    # 1. åˆ›å»ºä¸»é¢˜
    create_response = await client.post("/api/v1/topics", json=sample_topic_data)
    assert create_response.status_code == 200
    
    # 2. è·å–ä¸»é¢˜
    topic_id = create_response.json()["data"]["id"]
    get_response = await client.get(f"/api/v1/topics/{topic_id}")
    assert get_response.status_code == 200
    
    # 3. æ›´æ–°ä¸»é¢˜
    update_response = await client.put(f"/api/v1/topics/{topic_id}", json=update_data)
    assert update_response.status_code == 200
    
    # 4. åˆ é™¤ä¸»é¢˜
    delete_response = await client.delete(f"/api/v1/topics/{topic_id}")
    assert delete_response.status_code == 200
```

### å…¨æ ˆå·¥ä½œæµæµ‹è¯•ç¤ºä¾‹
```python
async def test_complete_knowledge_management_workflow(client):
    """æµ‹è¯•å®Œæ•´çš„çŸ¥è¯†ç®¡ç†å·¥ä½œæµ"""
    # 1. åˆ›å»ºçŸ¥è¯†ä¸»é¢˜
    # 2. ä¸Šä¼ å¤šä¸ªæ–‡ä»¶åˆ°ä¸»é¢˜
    # 3. ä»æ–‡ä»¶åˆ›å»ºæ–‡æ¡£
    # 4. å¤„ç†æ–‡æ¡£ï¼ˆåˆ†å—å’Œå‘é‡åŒ–ï¼‰
    # 5. æœç´¢éªŒè¯
    # 6. æ›´æ–°å†…å®¹
    # 7. å®Œæ•´æ€§éªŒè¯
```

## ğŸ“‹ éªŒè¯æ¸…å•

å½“è¿è¡Œæµ‹è¯•æ—¶ï¼Œç¡®ä¿éªŒè¯ä»¥ä¸‹æ–¹é¢ï¼š

### âœ… åŠŸèƒ½éªŒè¯
- [ ] æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”
- [ ] æ•°æ®åº“CRUDæ“ä½œæˆåŠŸ
- [ ] æ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†æ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½è¿”å›æ­£ç¡®ç»“æœ
- [ ] é”™è¯¯å¤„ç†æŒ‰é¢„æœŸå·¥ä½œ

### âœ… æ•°æ®å®Œæ•´æ€§
- [ ] æ•°æ®åº“çº¦æŸå¾—åˆ°éµå®ˆ
- [ ] å…³ç³»æ¨¡å‹å·¥ä½œæ­£å¸¸
- [ ] äº‹åŠ¡å¤„ç†æ­£ç¡®
- [ ] æ•°æ®åœ¨æ“ä½œåä¿æŒä¸€è‡´

### âœ… æ€§èƒ½éªŒè¯
- [ ] å¹¶å‘æ“ä½œæ­£å¸¸æ‰§è¡Œ
- [ ] å“åº”æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´å†…
- [ ] ç³»ç»Ÿåœ¨è´Ÿè½½ä¸‹ä¿æŒç¨³å®š
- [ ] å†…å­˜ä½¿ç”¨åˆç†

### âœ… é”™è¯¯å¤„ç†
- [ ] æ— æ•ˆè¾“å…¥å¾—åˆ°æ­£ç¡®å¤„ç†
- [ ] HTTPé”™è¯¯çŠ¶æ€ç å‡†ç¡®
- [ ] ç³»ç»Ÿå¯ä»¥ä»é”™è¯¯ä¸­æ¢å¤
- [ ] é”™è¯¯ä¿¡æ¯å¯¹ç”¨æˆ·å‹å¥½

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥PostgreSQLæœåŠ¡
   sudo systemctl status postgresql
   # æˆ–è€…ä½¿ç”¨Docker
   docker ps | grep postgres
   ```

2. **æ¨¡å—å¯¼å…¥é”™è¯¯**
   ```bash
   # ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæµ‹è¯•
   cd /path/to/research-agent-rag
   export PYTHONPATH=.
   ```

3. **æµ‹è¯•è¶…æ—¶**
   ```bash
   # å¢åŠ è¶…æ—¶æ—¶é—´
   pytest tests/integration/ --timeout=300
   ```

4. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ
   netstat -tlnp | grep :8000
   ```

## ğŸ‰ æˆæœå±•ç¤º

é€šè¿‡è¿™ä¸ªå®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. **é›¶Mockç­–ç•¥**: æ‰€æœ‰æµ‹è¯•éƒ½ä½¿ç”¨çœŸå®çš„æ•°æ®åº“å’ŒæœåŠ¡
2. **å…¨æ ˆè¦†ç›–**: ä»APIåˆ°æ•°æ®åº“çš„æ¯ä¸€å±‚éƒ½æœ‰æµ‹è¯•è¦†ç›–
3. **å®é™…å·¥ä½œæµ**: æµ‹è¯•çœŸå®çš„ç”¨æˆ·ä½¿ç”¨åœºæ™¯
4. **é”™è¯¯å¼¹æ€§**: éªŒè¯ç³»ç»Ÿåœ¨å„ç§é”™è¯¯æƒ…å†µä¸‹çš„è¡¨ç°
5. **æ€§èƒ½åŸºå‡†**: å»ºç«‹åŸºæœ¬çš„æ€§èƒ½æœŸæœ›

è¿™ç¡®ä¿äº†RAGçŸ¥è¯†ç®¡ç†ç³»ç»Ÿçš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯åˆ‡å®å¯è¿è¡Œçš„ï¼Œç¬¦åˆç”¨æˆ·å¯¹"æˆ‘è¦ä¿è¯æˆ‘çš„ä»£ç æ˜¯åˆ‡å®å¯è¿è¡Œçš„"çš„è¦æ±‚ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨è¿è¡Œæµ‹è¯•æ—¶é‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥prerequisitesæ˜¯å¦æ»¡è¶³
2. æŸ¥çœ‹æµ‹è¯•æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. å‚è€ƒtests/README.mdè·å–æ›´å¤šå¸®åŠ©
4. æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒæœåŠ¡çŠ¶æ€

æµ‹è¯•çš„æ ¸å¿ƒç›®æ ‡æ˜¯éªŒè¯ç³»ç»Ÿçš„çœŸå®å¯ç”¨æ€§ï¼Œæ¯ä¸ªæµ‹è¯•éƒ½ä»£è¡¨äº†çœŸå®çš„ç”¨æˆ·æ“ä½œåœºæ™¯ã€‚