# PRD: Canvas视图侧边栏设计

| Document Info | Details |
| --- | --- |
| **Version** | v1.0 |
| **Status** | Design Phase |
| **Scope** | Canvas View Sidebar & View Modes |
| **Feature Type** | Enhancement to Canvas |

---

## 1. 方案分析

### 1.1 用户提案

**核心想法**：在Canvas视图中，右侧加入侧边栏，可以切换不同的展示模式：
- Free Node（自由节点）
- 知识图谱
- 思考路径
- 其他展示模式

### 1.2 方案优势

**完全分离**：
- 不同类型的节点完全分离，通过视图切换实现
- 每个视图只显示对应类型的节点
- 避免视觉混乱

**符合心理模型**：
- 类似文件浏览器的视图切换（列表/网格/详情）
- 用户熟悉这种交互模式
- 直观、易理解

**灵活切换**：
- 可以快速切换视图
- 每个视图保持独立的状态（位置、缩放等）
- 可以同时查看多个视图（分屏模式）

**空间利用**：
- 不占用Canvas主区域
- 侧边栏可以折叠
- 保持Canvas的无限空间感

### 1.3 与Section方案对比

| 特性 | Section方案 | 侧边栏视图方案 |
|------|------------|---------------|
| **分离程度** | 在同一Canvas上，通过Section分组 | 完全分离，不同视图 |
| **切换方式** | 折叠/展开Section | 切换视图模式 |
| **空间占用** | Section占用Canvas空间 | 侧边栏不占用Canvas空间 |
| **视觉清晰度** | 中等（仍有视觉边界） | 高（完全分离） |
| **实现复杂度** | 低（基于现有Section） | 中（需要视图系统） |
| **用户体验** | 需要管理Section | 切换视图即可 |

**结论**：侧边栏视图方案更彻底地解决了节点混乱问题，但实现复杂度更高。可以考虑**结合使用**：侧边栏视图 + Section（作为视图内的组织方式）。

---

## 2. 设计方案

### 2.1 整体布局

**Canvas区域结构**：
```
┌─────────────────────────────────────────────────┐
│  [Canvas主区域]              [视图侧边栏]      │
│  ┌─────────────────────────┐  ┌─────────────┐  │
│  │                         │  │ 视图切换     │  │
│  │   Canvas画布            │  │ ┌─────────┐ │  │
│  │   (当前视图的节点)       │  │ │Free Node│ │  │
│  │                         │  │ ├─────────┤ │  │
│  │                         │  │ │知识图谱 │ │  │
│  │                         │  │ ├─────────┤ │  │
│  │                         │  │ │思考路径 │ │  │
│  │                         │  │ ├─────────┤ │  │
│  │                         │  │ │其他...  │ │  │
│  │                         │  │ └─────────┘ │  │
│  └─────────────────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────┘
```

**侧边栏位置**：Canvas右侧，可折叠

**侧边栏宽度**：280px（默认），可调整（200px - 400px）

### 2.2 视图模式定义

#### 视图1：Free Node（自由节点）

**定义**：用户自由创建和组织的节点，包括：
- 从PDF拖拽/右键创建的知识卡片
- 从Assistant对话"Add to Canvas"的节点
- 用户手动创建的节点
- 从思考路径提升的节点

**特点**：
- 完全自由的组织方式
- 用户可以任意拖拽、连接
- 没有固定的结构约束

**用途**：
- 日常的知识整理
- 自由思考和组织
- 临时笔记和想法

#### 视图2：知识图谱（Knowledge Graph）

**定义**：从Graph自动提取的实体和关系，形成知识图谱

**特点**：
- 自动生成，基于文档分析
- 节点是实体（概念、人物、组织等）
- 连接是关系（相关、属于、导致等）
- 可以自动布局（力导向图）

**用途**：
- 查看文档中的知识结构
- 发现实体之间的关系
- 理解文档的知识体系

**数据来源**：
- Graph提取的实体（EntityModel）
- Graph提取的关系（RelationModel）
- 通过CanvasSyncerTask自动同步

#### 视图3：思考路径（Thinking Paths）

**定义**：深度探索对话产生的思考路径图

**特点**：
- 每个深度探索对话创建一个思考路径
- 节点是提问、回答、结论
- 连接表示思考的逻辑关系
- 可以折叠为Section（在视图内）

**用途**：
- 回顾思考过程
- 理解知识是如何被构建的
- 将重要的思考节点提升为知识节点

**数据来源**：
- 深度探索对话记录
- 思考路径节点和连接

#### 视图4：混合视图（Mixed View）

**定义**：同时显示多种类型的节点（可选）

**特点**：
- 可以自定义显示哪些类型的节点
- 通过过滤器控制
- 适合需要同时查看多种内容的场景

**用途**：
- 需要同时查看知识节点和思考路径
- 对比不同视图的内容
- 整合多种类型的节点

### 2.3 侧边栏设计

#### 2.3.1 侧边栏结构

```
┌─────────────────────────┐
│ 视图模式                │
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │ 📝 Free Node        │ │ ← 当前视图
│ │    (12个节点)       │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 🗺️  知识图谱        │ │
│ │    (8个实体)        │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 🌱 思考路径         │ │
│ │    (3个路径)        │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 🔀 混合视图         │ │
│ │    (自定义)         │ │
│ └─────────────────────┘ │
├─────────────────────────┤
│ [设置] [折叠]            │
└─────────────────────────┘
```

#### 2.3.2 视图卡片设计

**当前视图**：
- 高亮显示（蓝色背景）
- 显示节点数量
- 显示视图状态（如"已保存"）

**其他视图**：
- 正常显示（白色背景）
- 显示节点数量
- 点击切换视图

**交互**：
- 点击视图卡片 → 切换视图
- 悬停 → 显示预览（可选）
- 右键 → 显示操作菜单（删除、重命名等）

#### 2.3.3 侧边栏操作

**折叠/展开**：
- 点击"折叠"按钮 → 侧边栏折叠为图标条
- 折叠后只显示当前视图图标
- 点击图标 → 展开侧边栏

**设置**：
- 点击"设置" → 打开视图设置面板
- 可以调整视图参数（布局、显示选项等）

### 2.4 视图切换机制

#### 2.4.1 切换流程

1. **用户点击视图卡片**
2. **保存当前视图状态**（节点位置、缩放、选择等）
3. **加载目标视图**（节点、连接、状态）
4. **更新Canvas显示**
5. **更新侧边栏高亮**

#### 2.4.2 视图状态管理

**每个视图独立的状态**：
- 节点位置和布局
- 视图缩放级别
- 选中的节点
- 视图过滤器设置
- 视图特定的设置

**状态持久化**：
- 每个视图的状态独立保存
- 切换视图时自动保存和恢复
- 支持撤销/重做（每个视图独立）

#### 2.4.3 切换动画

**过渡效果**：
- 淡入淡出（0.2秒）
- 平滑过渡，不突兀
- 保持Canvas的连续性

### 2.5 视图内组织（结合Section方案）

**设计理念**：在视图内，仍然可以使用Section来组织节点

**Free Node视图**：
- 节点可以自由组织
- 可以创建Section分组
- 可以折叠/展开Section

**知识图谱视图**：
- 自动布局（力导向图）
- 可以按实体类型分组
- 可以折叠/展开分组

**思考路径视图**：
- 每个思考路径是一个Section
- Section可以折叠/展开
- 可以管理多个思考路径

**混合视图**：
- 可以按类型分组
- 每个类型是一个Section
- 可以折叠/展开不同类型

---

## 3. 详细交互设计

### 3.1 侧边栏交互

#### 3.1.1 视图切换

**点击切换**：
1. 用户点击视图卡片
2. 侧边栏显示加载状态（可选）
3. Canvas切换视图
4. 侧边栏更新高亮

**快捷键**：
- `Cmd+1`：切换到Free Node视图
- `Cmd+2`：切换到知识图谱视图
- `Cmd+3`：切换到思考路径视图
- `Cmd+4`：切换到混合视图

#### 3.1.2 视图预览

**悬停预览**（可选）：
- 鼠标悬停在视图卡片上
- 显示视图的缩略图预览
- 显示节点数量和最后更新时间

**预览内容**：
- 视图的缩略图（Canvas的缩小版）
- 节点数量统计
- 最后更新时间

#### 3.1.3 视图操作菜单

**右键菜单**：
```
┌─────────────────────────┐
│ 📝 Free Node            │
├─────────────────────────┤
│ 📋 复制视图              │
│ 🔄 刷新视图              │
│ ⚙️  视图设置             │
│ 🗑️  清空视图             │
│ 📤 导出视图              │
└─────────────────────────┘
```

**操作说明**：
- **复制视图**：复制当前视图的所有节点
- **刷新视图**：重新加载视图数据
- **视图设置**：打开视图设置面板
- **清空视图**：删除视图内所有节点（确认对话框）
- **导出视图**：导出为图片或JSON

### 3.2 视图内交互

#### 3.2.1 Free Node视图

**特点**：
- 完全自由的组织方式
- 用户可以任意拖拽、连接
- 支持Section分组（可选）

**操作**：
- 拖拽节点：移动节点位置
- 连接节点：创建连接线
- 创建Section：框选节点创建分组
- 编辑节点：双击编辑内容

#### 3.2.2 知识图谱视图

**特点**：
- 自动布局（力导向图）
- 节点是实体，连接是关系
- 可以按类型过滤

**操作**：
- 自动布局：点击"自动布局"按钮
- 过滤实体：选择实体类型（概念、人物、组织等）
- 查看关系：点击连接线查看关系详情
- 编辑实体：双击实体编辑信息

**布局算法**：
- 默认：力导向图布局
- 可选：层次布局、圆形布局等
- 可以手动调整节点位置

#### 3.2.3 思考路径视图

**特点**：
- 每个思考路径是一个Section
- Section可以折叠/展开
- 可以管理多个思考路径

**操作**：
- 展开/折叠Section：点击Section标题
- 查看思考路径：展开对应的Section
- 提升节点：右键节点 → "提升为知识节点"
- 删除思考路径：右键Section → "删除"

**Section管理**：
- 可以拖拽Section移动位置
- 可以合并多个Section
- 可以归档旧的思考路径

#### 3.2.4 混合视图

**特点**：
- 可以自定义显示哪些类型的节点
- 通过过滤器控制
- 可以按类型分组

**操作**：
- 选择显示类型：勾选要显示的类型
- 按类型分组：自动创建Section分组
- 切换分组显示：折叠/展开不同类型

### 3.3 视图设置

#### 3.3.1 设置面板

**位置**：点击侧边栏"设置"按钮打开

**设置内容**：

**Free Node视图设置**：
- 默认节点大小
- 网格对齐
- 自动保存间隔

**知识图谱视图设置**：
- 布局算法（力导向图/层次/圆形）
- 节点大小（按度数/固定）
- 连接线样式
- 实体类型过滤

**思考路径视图设置**：
- 默认Section折叠状态
- 节点样式
- 连接线样式

**混合视图设置**：
- 显示的类型选择
- 分组方式
- 节点样式

#### 3.3.2 视图同步

**跨视图操作**：
- 在思考路径视图中"提升节点" → 自动添加到Free Node视图
- 在知识图谱视图中"创建节点" → 可以选择添加到哪个视图
- 支持节点在不同视图间移动

---

## 4. 视觉设计规范

### 4.1 侧边栏视觉设计

**侧边栏样式**：
- 背景色：白色/浅灰色
- 边框：右侧有分隔线
- 宽度：280px（默认）
- 可调整：200px - 400px

**视图卡片样式**：
- 当前视图：蓝色背景，白色文字
- 其他视图：白色背景，灰色文字
- 悬停：浅灰色背景
- 圆角：8px
- 内边距：12px

**图标设计**：
- Free Node：📝 文档图标
- 知识图谱：🗺️ 地图图标
- 思考路径：🌱 植物图标
- 混合视图：🔀 混合图标

### 4.2 视图切换动画

**过渡效果**：
- 淡入淡出：0.2秒
- 平滑过渡
- 保持Canvas的连续性

**加载状态**：
- 切换视图时显示加载指示器
- 快速切换（<100ms）不显示加载

### 4.3 视图标识

**视图标题**：
- 显示在Canvas顶部（可选）
- 显示当前视图名称和节点数量
- 可以点击切换视图

**视图状态**：
- 显示视图的保存状态
- 显示最后更新时间
- 显示节点数量

---

## 5. 与现有设计结合

### 5.1 与Section方案结合

**设计理念**：侧边栏视图 + Section（视图内组织）

**结合方式**：
- 侧边栏负责视图切换（大粒度分离）
- Section负责视图内组织（小粒度分组）
- 两者互补，不冲突

**示例**：
- **思考路径视图**：每个思考路径是一个Section，可以折叠/展开
- **Free Node视图**：可以创建Section分组，组织相关节点
- **知识图谱视图**：可以按实体类型创建Section分组

### 5.2 与现有功能结合

**Canvas Copilot**：
- 在不同视图中都可以使用
- 根据当前视图调整功能（如知识图谱视图的"自动布局"）

**节点操作**：
- 节点操作在不同视图中保持一致
- 支持跨视图操作（如"提升节点"）

**连接系统**：
- 连接系统在不同视图中保持一致
- 不同视图的连接可能有不同的语义（如知识图谱的关系类型）

---

## 6. 实施优先级

### Phase 1（MVP）：基础视图切换

**功能**：
- 侧边栏基础结构
- Free Node视图（默认）
- 思考路径视图
- 视图切换机制

**优势**：
- 实现简单，解决核心问题
- 验证用户需求
- 为后续扩展打下基础

### Phase 2（增强）：知识图谱视图

**功能**：
- 知识图谱视图
- 自动布局算法
- 实体类型过滤
- 关系可视化

**优势**：
- 充分利用Graph数据
- 提供知识图谱可视化
- 增强产品价值

### Phase 3（优化）：混合视图和高级功能

**功能**：
- 混合视图
- 视图设置面板
- 跨视图操作
- 视图导出

**优势**：
- 提供更灵活的使用方式
- 增强用户体验
- 形成完整的视图系统

---

## 7. 用户心理曲线

### 7.1 首次使用侧边栏

**阶段一：发现（0-30秒）**
- **心理状态**：好奇、探索
- **行为**：看到侧边栏，点击查看
- **情绪**：好奇、想知道是什么
- **设计要点**：清晰的视觉标识，让用户知道可以切换视图

**阶段二：理解（30秒-2分钟）**
- **心理状态**：理解、适应
- **行为**：切换视图，理解不同视图的用途
- **情绪**：理解、适应
- **设计要点**：视图切换流畅，状态清晰

**阶段三：利用（2分钟+）**
- **心理状态**：主动利用
- **行为**：根据场景切换视图，组织内容
- **情绪**：满足、控制感
- **设计要点**：提供丰富的视图功能

### 7.2 使用不同视图

**心理曲线**：
```
混乱(节点太多) → 尝试(切换视图) → 清晰(找到需要的) → 满足(Canvas清晰)
```

**情绪变化**：
- 节点太多：混乱（找不到需要的）
- 切换视图：尝试（看看能不能解决）
- 找到需要的：清晰（现在清楚了）
- Canvas清晰：满足（可以专注工作）

---

## 8. 问题解决验证

### 8.1 问题1：视觉混乱 → 解决

**解决方案**：侧边栏视图切换，完全分离不同类型的节点

**验证指标**：
- 用户能快速找到需要的视图
- 不同视图不互相干扰
- 用户反馈"Canvas更清晰了"

### 8.2 问题2：认知负荷 → 解决

**解决方案**：视图切换，每个视图只显示相关节点

**验证指标**：
- 用户会使用视图切换功能
- 用户能理解不同视图的用途
- 用户反馈"更容易找到需要的节点"

### 8.3 问题3：组织困难 → 解决

**解决方案**：视图内组织（Section）+ 跨视图操作

**验证指标**：
- 用户会在视图内使用Section组织
- 用户会使用跨视图操作（如"提升节点"）
- 用户能有效组织Canvas

---

## 9. 设计原则总结

### 9.1 完全分离

- 不同类型的节点完全分离
- 通过视图切换实现
- 每个视图独立的状态

### 9.2 灵活切换

- 可以快速切换视图
- 视图状态自动保存和恢复
- 支持快捷键

### 9.3 视图内组织

- 在视图内可以使用Section组织
- 结合Section方案，提供多层次组织
- 灵活适应不同场景

### 9.4 跨视图操作

- 支持节点在不同视图间移动
- 支持跨视图操作（如"提升节点"）
- 保持操作的连贯性

---

## 附录：用户场景示例

### 场景一：使用视图切换组织内容

**用户**：研究员，整理多个主题的知识
**体验**：
1. 在Free Node视图中整理日常笔记
2. 切换到知识图谱视图，查看文档中的实体关系
3. 切换到思考路径视图，回顾深度探索的思考过程
4. 将重要的思考节点提升为知识节点，自动添加到Free Node视图
5. 根据需要切换视图，保持Canvas清晰

### 场景二：使用知识图谱视图

**用户**：学生，学习复杂主题
**体验**：
1. 上传多个相关文档
2. 系统自动提取实体和关系
3. 切换到知识图谱视图，查看知识结构
4. 使用自动布局，优化图谱显示
5. 按实体类型过滤，聚焦特定类型的实体
6. 理解知识之间的关系，形成知识体系

### 场景三：管理思考路径

**用户**：产品经理，研究多个问题
**体验**：
1. 完成多个深度探索对话，产生多个思考路径
2. 切换到思考路径视图，查看所有思考路径
3. 展开需要的思考路径，回顾思考过程
4. 将重要的结论节点提升为知识节点
5. 归档旧的思考路径，保持视图清晰
6. 在Free Node视图中整合所有知识
