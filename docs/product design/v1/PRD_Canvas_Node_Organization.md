# PRD: Canvas节点组织与清晰度设计

| Document Info | Details |
| --- | --- |
| **Version** | v1.0 |
| **Status** | Design Phase |
| **Scope** | Canvas Node Organization & Visual Clarity |
| **Feature Type** | Enhancement to Canvas |

---

## 1. 问题分析

### 1.1 当前Canvas节点来源

**现有节点类型**：
1. **知识卡片**：从PDF拖拽/右键创建，有sourceId，是"内容"
2. **对话节点**：从Assistant对话"Add to Canvas"，是"洞察"
3. **实体节点**：从Graph自动提取（CanvasSyncerTask），是"知识图谱"
4. **手动节点**：用户手动创建，是"笔记"

**新增节点类型**（思考路径图）：
5. **提问节点**：AI的提问，是"过程"
6. **回答节点**：用户的回答，是"过程"
7. **结论节点**：最终结论，是"过程+结果"

### 1.2 冲突问题

**视觉混乱**：
- 不同类型的节点混在一起，难以区分
- 思考路径图节点（过程）与知识节点（内容）混在一起
- Canvas变得拥挤，影响理解

**认知负荷**：
- 用户需要区分"这是什么类型的节点？"
- 思考路径图是临时的（用于理解过程），知识节点是永久的（用于知识沉淀）
- 混在一起增加了认知负担

**组织困难**：
- 难以找到特定类型的节点
- 难以管理思考路径图（可能有很多个）
- 难以清理不需要的思考路径

---

## 2. 设计目标

### 2.1 核心目标

**保持Canvas清晰**：
- 不同类型的节点清晰区分
- 思考路径图不干扰知识节点
- 用户可以快速找到需要的节点

**灵活控制**：
- 可以隐藏/显示特定类型的节点
- 可以管理思考路径图（删除、归档）
- 可以将思考节点提升为知识节点

**用户体验**：
- 不增加操作复杂度
- 符合用户心理模型
- 支持渐进式组织

### 2.2 设计原则

1. **分离关注点**：思考路径（过程）与知识节点（内容）分离
2. **可折叠**：思考路径图可以折叠，不占用空间
3. **可提升**：重要的思考节点可以提升为知识节点
4. **可过滤**：可以过滤显示特定类型的节点
5. **可归档**：旧的思考路径可以归档，不干扰当前工作

---

## 3. 解决方案设计

### 3.1 核心方案：思考路径Section

**设计理念**：
- 将思考路径图放在独立的"思考路径"Section中
- Section可以折叠/展开
- 每个深度探索对话创建一个Section
- Section有明确的视觉边界

**视觉设计**：
```
Canvas布局：
┌─────────────────────────────────────────────────┐
│  [知识节点区域]                                 │
│  ┌─────┐  ┌─────┐  ┌─────┐                    │
│  │知识1│  │知识2│  │知识3│                    │
│  └─────┘  └─────┘  └─────┘                    │
│                                                 │
│  [思考路径Section] ────────────────────────────│
│  ┌─────────────────────────────────────────┐  │
│  │ 🌱 思考路径: "什么是RAG？"  [折叠 ▼]    │  │
│  │ ┌─────┐ → ┌─────┐ → ┌─────┐ → ┌─────┐│  │
│  │ │提问1│   │回答1│   │提问2│   │结论 ││  │
│  │ └─────┘   └─────┘   └─────┘   └─────┘│  │
│  └─────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

**Section特性**：
- **标题**：显示对话的问题（如"什么是RAG？"）
- **折叠/展开**：点击标题栏可以折叠/展开
- **节点计数**：显示Section内节点数量
- **操作菜单**：右键菜单可以删除、归档、提升节点等

### 3.2 节点类型标识

**视觉区分**：

| 节点类型 | 边框颜色 | 图标 | 背景色 | 说明 |
|---------|---------|------|--------|------|
| **知识卡片** | 默认/白色 | 📄 | 白色 | 从PDF/文档创建 |
| **对话节点** | 蓝色 | 💡 | 浅蓝 | 从Assistant对话添加 |
| **实体节点** | 紫色 | 🏷️ | 浅紫 | 从Graph提取 |
| **提问节点** | 蓝色虚线 | 🤔 | 浅蓝 | AI的提问 |
| **回答节点** | 绿色虚线 | 💭 | 浅绿 | 用户的回答 |
| **结论节点** | 金色实线 | ✨ | 浅金 | 最终结论 |

**节点标识**：
- 节点左上角显示类型图标
- 节点边框颜色和样式区分类型
- 思考路径节点有虚线边框，知识节点有实线边框

### 3.3 视图过滤器

**过滤器位置**：Canvas工具栏

**过滤器选项**：
```
┌─────────────────────────────────────────┐
│ Canvas视图过滤器                        │
├─────────────────────────────────────────┤
│ ☑ 知识节点                              │
│ ☑ 对话节点                              │
│ ☑ 实体节点                              │
│ ☐ 思考路径（隐藏）                      │
│                                         │
│ [显示全部] [仅知识] [仅思考路径]         │
└─────────────────────────────────────────┘
```

**快速切换**：
- 工具栏按钮："仅知识"、"仅思考"、"全部"
- 快捷键：`Cmd+K` 切换知识节点，`Cmd+T` 切换思考路径

### 3.4 思考路径Section管理

#### 3.4.1 Section创建

**自动创建**：
- 深度探索对话开始时，自动创建"思考路径"Section
- Section标题：对话的问题（前30个字符）
- Section位置：Canvas右侧区域（不干扰左侧知识节点）

**手动创建**：
- 对话结束后，用户可以选择"添加到Canvas"
- 系统分析对话，生成思考路径图
- 创建新的Section

#### 3.4.2 Section折叠/展开

**折叠状态**：
```
┌─────────────────────────────────────────┐
│ 🌱 思考路径: "什么是RAG？"  [展开 ▶]   │
│ 包含 5 个节点                            │
└─────────────────────────────────────────┘
```

**展开状态**：
- 显示所有思考节点和连接
- 可以拖拽节点，重新布局
- 可以编辑节点内容

#### 3.4.3 Section操作

**右键菜单**：
```
┌─────────────────────────────────────────┐
│ 🌱 思考路径: "什么是RAG？"              │
├─────────────────────────────────────────┤
│ 📋 复制思考路径                          │
│ ⬆️  提升所有节点为知识节点                │
│ 📦 归档思考路径                          │
│ 🗑️  删除思考路径                         │
└─────────────────────────────────────────┘
```

**操作说明**：
- **复制**：复制整个思考路径到新位置
- **提升**：将所有节点提升为知识节点，移出Section
- **归档**：移到Canvas边缘，标记为"已归档"
- **删除**：删除整个思考路径（确认对话框）

### 3.5 节点提升机制

**设计理念**：
- 思考路径节点是"过程"，知识节点是"内容"
- 重要的思考节点可以提升为知识节点
- 提升后移出Section，成为独立的知识节点

**提升方式**：

**方式1：单个节点提升**
- 右键点击思考节点 → "提升为知识节点"
- 节点移出Section，成为独立的知识节点
- 保留节点内容，但移除思考路径的连接

**方式2：批量提升**
- 框选多个节点 → 右键 → "提升为知识节点"
- 所有选中的节点提升为知识节点

**方式3：Section整体提升**
- 右键Section → "提升所有节点为知识节点"
- Section内所有节点提升为知识节点
- Section自动删除

**提升后的节点**：
- 保留原内容
- 移除思考路径的连接
- 可以重新连接到其他知识节点
- 可以编辑、删除、移动

### 3.6 语义缩放支持

**设计理念**：
- 利用Canvas的语义缩放（L1/L2/L3）
- 在宏观视图下，思考路径Section自动折叠
- 减少视觉混乱，保持Canvas清晰

**缩放级别**：

**L1（微观）**：
- 显示所有节点和连接
- 思考路径Section展开
- 显示节点完整内容

**L2（中观）**：
- 隐藏节点详细内容，只显示标题
- 思考路径Section可以折叠
- 显示连接线

**L3（宏观）**：
- 思考路径Section自动折叠
- 只显示Section标题和节点数量
- 知识节点显示为小图标
- 连接线简化

**L3+（热力图）**：
- 思考路径Section完全隐藏（可选）
- 只显示知识节点密度
- 可以过滤显示特定类型

### 3.7 多思考路径管理

**场景**：用户有多个深度探索对话，产生多个思考路径Section

**管理方式**：

**1. Section分组**：
- 可以创建"思考历史"Section组
- 将多个思考路径Section放在一个组内
- 组可以折叠，只显示组标题

**2. Section归档**：
- 旧的思考路径可以归档
- 归档后移到Canvas边缘
- 可以随时取消归档

**3. Section合并**：
- 可以将多个相关的思考路径Section合并
- 合并后形成一个大的思考路径图

**4. Section删除**：
- 可以删除不需要的思考路径
- 删除前确认，避免误删

---

## 4. 详细交互设计

### 4.1 思考路径Section创建流程

**场景1：实时自动沉淀**

1. 用户开始深度探索对话
2. 系统检测到深度探索模式
3. 自动创建"思考路径"Section（在Canvas右侧）
4. AI提问 → 在Section内创建提问节点
5. 用户回答 → 在Section内创建回答节点
6. 建立连接：提问 → 回答 → 下一个提问
7. 用户得出结论 → 创建结论节点

**场景2：对话结束后沉淀**

1. 深度探索对话完成
2. Assistant Panel显示"将思考过程添加到Canvas"
3. 用户点击
4. 系统分析对话，生成思考路径图
5. 创建新的"思考路径"Section
6. 用户确认后，节点添加到Section

### 4.2 Section折叠/展开交互

**折叠**：
- 点击Section标题栏 → Section折叠
- 折叠后只显示标题和节点数量
- 节点和连接隐藏

**展开**：
- 点击折叠的Section → Section展开
- 显示所有节点和连接
- 可以编辑、拖拽节点

**自动折叠**：
- 在L3宏观视图下，思考路径Section自动折叠
- 切换到L1/L2视图时，保持用户的手动折叠状态

### 4.3 节点提升交互

**单个节点提升**：
1. 右键点击思考节点
2. 选择"提升为知识节点"
3. 节点移出Section，成为独立的知识节点
4. 移除思考路径的连接
5. 节点可以重新连接到其他知识节点

**批量提升**：
1. 框选多个思考节点
2. 右键 → "提升为知识节点"
3. 所有选中的节点提升
4. 如果Section内所有节点都提升，Section自动删除

**Section整体提升**：
1. 右键Section标题
2. 选择"提升所有节点为知识节点"
3. 所有节点提升
4. Section自动删除

### 4.4 视图过滤器交互

**过滤器位置**：Canvas工具栏右侧

**快速切换按钮**：
- "仅知识"：只显示知识节点、对话节点、实体节点
- "仅思考"：只显示思考路径Section
- "全部"：显示所有节点

**详细过滤器**：
- 点击过滤器图标 → 展开详细选项
- 可以勾选/取消勾选特定类型
- 实时更新Canvas显示

**快捷键**：
- `Cmd+K`：切换知识节点显示
- `Cmd+T`：切换思考路径显示
- `Cmd+A`：显示全部

### 4.5 Section管理交互

**Section操作菜单**：
- 右键Section标题 → 显示操作菜单
- 选项：复制、提升、归档、删除

**Section拖拽**：
- 可以拖拽Section标题栏，移动整个Section
- 移动时，Section内所有节点一起移动
- 保持相对位置不变

**Section合并**：
1. 选择多个思考路径Section
2. 右键 → "合并思考路径"
3. 合并为一个Section
4. 节点自动重新布局

---

## 5. 视觉设计规范

### 5.1 Section视觉设计

**展开状态**：
```
┌─────────────────────────────────────────────┐
│ 🌱 思考路径: "什么是RAG？"  [折叠 ▼]      │
│ 包含 5 个节点 | 创建于 2分钟前              │
├─────────────────────────────────────────────┤
│ ┌─────┐ → ┌─────┐ → ┌─────┐ → ┌─────┐   │
│ │提问1│   │回答1│   │提问2│   │结论 │   │
│ └─────┘   └─────┘   └─────┘   └─────┘   │
└─────────────────────────────────────────────┘
```

**折叠状态**：
```
┌─────────────────────────────────────────────┐
│ 🌱 思考路径: "什么是RAG？"  [展开 ▶]      │
│ 包含 5 个节点                                │
└─────────────────────────────────────────────┘
```

**设计要点**：
- Section有明确的边框和背景色（浅灰色）
- 标题栏有图标和操作按钮
- 节点在Section内，有视觉边界

### 5.2 节点视觉区分

**知识节点**：
- 实线边框，白色背景
- 左上角显示类型图标（📄）
- 可以拖拽、编辑、删除

**思考节点**：
- 虚线边框，浅色背景
- 左上角显示类型图标（🤔/💭/✨）
- 在Section内，可以提升为知识节点

**视觉层次**：
- 知识节点：实线边框，更突出
- 思考节点：虚线边框，更轻量
- 通过边框样式和颜色区分

### 5.3 连接线视觉区分

**知识节点连接**：
- 实线，蓝色
- 表示知识关系

**思考路径连接**：
- 虚线，灰色
- 表示思考逻辑
- 只在Section内显示

---

## 6. 用户心理曲线

### 6.1 首次使用思考路径Section

**阶段一：发现（0-30秒）**
- **心理状态**：好奇、探索
- **行为**：开始深度探索对话，发现Canvas上出现Section
- **情绪**：惊喜、好奇
- **设计要点**：清晰的视觉反馈，让用户知道发生了什么

**阶段二：理解（30秒-2分钟）**
- **心理状态**：理解、适应
- **行为**：观察Section如何工作，理解思考路径
- **情绪**：理解、适应
- **设计要点**：Section有明确的边界和标识

**阶段三：利用（2分钟+）**
- **心理状态**：主动利用
- **行为**：折叠不需要的Section，提升重要的节点
- **情绪**：满足、控制感
- **设计要点**：提供丰富的管理功能

### 6.2 使用视图过滤器

**心理曲线**：
```
混乱(节点太多) → 尝试(使用过滤器) → 清晰(找到需要的) → 满足(Canvas清晰)
```

**情绪变化**：
- 节点太多：混乱（找不到需要的）
- 使用过滤器：尝试（看看能不能解决）
- 找到需要的：清晰（现在清楚了）
- Canvas清晰：满足（可以专注工作）

---

## 7. 问题解决验证

### 7.1 问题1：视觉混乱 → 解决

**解决方案**：思考路径Section + 节点类型标识

**验证指标**：
- 用户能快速区分不同类型的节点
- 思考路径不干扰知识节点
- 用户反馈"Canvas更清晰了"

### 7.2 问题2：认知负荷 → 解决

**解决方案**：Section折叠 + 视图过滤器

**验证指标**：
- 用户会使用Section折叠功能
- 用户会使用视图过滤器
- 用户反馈"更容易找到需要的节点"

### 7.3 问题3：组织困难 → 解决

**解决方案**：Section管理 + 节点提升

**验证指标**：
- 用户会管理思考路径Section（删除、归档）
- 用户会将重要的思考节点提升为知识节点
- 用户能有效组织Canvas

---

## 8. 实施优先级

### Phase 1（MVP）：基础Section功能

**功能**：
- 思考路径图放在独立的Section中
- Section可以折叠/展开
- 节点类型视觉区分

**优势**：
- 实现简单，解决核心问题
- 保持Canvas清晰
- 可以验证用户需求

### Phase 2（增强）：管理功能

**功能**：
- 视图过滤器
- Section操作菜单（删除、归档）
- 节点提升机制

**优势**：
- 提供更灵活的管理
- 用户可以控制Canvas
- 增强用户体验

### Phase 3（优化）：高级功能

**功能**：
- Section分组和合并
- 语义缩放支持
- 智能布局和归档

**优势**：
- 更智能的体验
- 自动管理，减少用户操作
- 形成完整的组织体系

---

## 9. 设计原则总结

### 9.1 分离关注点

- 思考路径（过程）与知识节点（内容）分离
- 通过Section和视觉区分实现

### 9.2 可折叠

- 思考路径Section可以折叠
- 不占用Canvas空间
- 需要时可以展开

### 9.3 可提升

- 重要的思考节点可以提升为知识节点
- 从"过程"变为"内容"
- 保留价值，去除临时性

### 9.4 可过滤

- 可以过滤显示特定类型的节点
- 快速找到需要的节点
- 保持Canvas清晰

### 9.5 可归档

- 旧的思考路径可以归档
- 不干扰当前工作
- 可以随时查看

---

## 附录：用户场景示例

### 场景一：使用思考路径Section

**用户**：学生，学习"机器学习中的过拟合"
**问题**："如何理解过拟合？"
**选择模式**：Level 3 (深度探索)
**体验**：
1. 开始对话，Canvas上自动创建"思考路径"Section
2. AI提问，在Section内创建提问节点
3. 用户回答，在Section内创建回答节点
4. 完成对话，查看思考路径图
5. 将重要的结论节点提升为知识节点
6. 折叠Section，Canvas保持清晰

### 场景二：管理多个思考路径

**用户**：研究员，研究多个主题
**体验**：
1. 完成多个深度探索对话，有多个思考路径Section
2. 使用视图过滤器，只显示知识节点
3. 查看思考路径时，展开对应的Section
4. 将重要的思考节点提升为知识节点
5. 归档旧的思考路径，保持Canvas清晰

### 场景三：组织Canvas

**用户**：产品经理，整理知识体系
**体验**：
1. Canvas上有知识节点和多个思考路径Section
2. 使用视图过滤器，隐藏思考路径
3. 专注于知识节点的组织
4. 需要回顾思考过程时，展开对应的Section
5. 将重要的思考节点提升为知识节点，整合到知识体系中
