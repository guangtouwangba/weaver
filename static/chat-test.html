<!DOCTYPE html>
<html>
<head>
    <title>Chat API å¿«é€Ÿæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; }
        #messages { height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Chat API å¿«é€Ÿæµ‹è¯•</h1>
    
    <div class="test-result info">
        <strong>æµ‹è¯•ç›®æ ‡:</strong> éªŒè¯Chat APIæ˜¯å¦æ­£å¸¸å·¥ä½œ
    </div>
    
    <button onclick="testStreamChat()">æµ‹è¯•æµå¼èŠå¤©</button>
    <button onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
    <button onclick="clearMessages()">æ¸…ç©ºæ¶ˆæ¯</button>
    
    <h3>å®æ—¶æ¶ˆæ¯:</h3>
    <div id="messages"></div>
    
    <script>
        function addMessage(message, type = "info") {
            const messages = document.getElementById("messages");
            const div = document.createElement("div");
            div.className = `test-result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
        
        async function testHealthCheck() {
            addMessage("ğŸ” æµ‹è¯•å¥åº·æ£€æŸ¥...", "info");
            try {
                const response = await fetch("/api/v1/chat/health");
                const data = await response.json();
                addMessage(`âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, "success");
            } catch (error) {
                addMessage(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, "error");
            }
        }
        
        async function testStreamChat() {
            addMessage("ğŸŒŠ å¼€å§‹æµ‹è¯•æµå¼èŠå¤©...", "info");
            
            const requestData = {
                message: "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
                topic_id: null,
                max_results: 5,
                include_context: true,
                temperature: 0.7,
                max_tokens: 1000
            };
            
            try {
                const response = await fetch("/api/v1/chat/stream", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "text/event-stream"
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                addMessage("âœ… è¿æ¥æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æ•°æ®...", "success");
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split("\n");
                    
                    for (const line of lines) {
                        if (line.startsWith("data: ")) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                addMessage(`ğŸ“¦ æ”¶åˆ°æ•°æ®: ${JSON.stringify(data)}`, "success");
                            } catch (e) {
                                // å¿½ç•¥éJSONæ•°æ®
                            }
                        } else if (line.startsWith("event: ")) {
                            const eventType = line.slice(7);
                            addMessage(`ğŸ·ï¸ äº‹ä»¶ç±»å‹: ${eventType}`, "info");
                        }
                    }
                }
                
                addMessage("âœ… æµå¼èŠå¤©æµ‹è¯•å®Œæˆï¼", "success");
                
            } catch (error) {
                addMessage(`âŒ æµå¼èŠå¤©æµ‹è¯•å¤±è´¥: ${error.message}`, "error");
            }
        }
        
        function clearMessages() {
            document.getElementById("messages").innerHTML = "";
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
        window.onload = function() {
            addMessage("ğŸš€ Chat API æµ‹è¯•é¡µé¢å·²åŠ è½½", "info");
            testHealthCheck();
        };
    </script>
</body>
</html>
