"""
pytest configuration for integration tests
"""
import pytest

# Mark slow tests
def pytest_configure(config):
    config.addinivalue_line("markers", "integration: mark test as integration test")
    config.addinivalue_line("markers", "slow: mark test as slow running")
    config.addinivalue_line("markers", "database: mark test as database integration test")
    config.addinivalue_line("markers", "api: mark test as API integration test")
    config.addinivalue_line("markers", "fullstack: mark test as full stack integration test")

# Custom collection based on markers
def pytest_collection_modifyitems(config, items):
    """Add markers to tests based on their location or name."""
    for item in items:
        # Mark integration tests
        if "integration" in str(item.fspath):
            item.add_marker(pytest.mark.integration)
        
        # Mark database tests
        if "database" in str(item.fspath) or "database" in item.name:
            item.add_marker(pytest.mark.database)
        
        # Mark API tests
        if "_api.py" in str(item.fspath):
            item.add_marker(pytest.mark.api)
        
        # Mark full stack tests
        if "full_stack" in str(item.fspath):
            item.add_marker(pytest.mark.fullstack)
            item.add_marker(pytest.mark.slow)

# Skip tests if certain conditions aren't met
def pytest_runtest_setup(item):
    """Setup function run before each test."""
    # Skip integration tests if running in unit test mode
    if item.get_closest_marker("integration"):
        if item.config.getoption("-m") == "unit":
            pytest.skip("Skipping integration test in unit test mode")