# studio Specification

## Purpose
TBD - created by archiving change add-document-summary. Update Purpose after archive.
## Requirements
### Requirement: Document Selection State
The Resource Sidebar SHALL provide visual feedback when documents are selected.

#### Scenario: Active document styling
- **WHEN** a user clicks a document card
- **THEN** the card border becomes highlighted (e.g., primary color)
- **AND** the background color changes to indicate selection

### Requirement: Inspiration Dock Summary Action
The Inspiration Dock SHALL offer a mechanism to trigger summarization.

#### Scenario: Summarize button availability
- **WHEN** one or more documents are selected in the sidebar
- **THEN** the Inspiration Dock displays a "Summarize" option/icon

### Requirement: Summary Card Display
The system SHALL display the generated summary in a dedicated card format.

#### Scenario: Summary presentation
- **WHEN** the summary generation is complete
- **THEN** a Summary Card appears containing:
  - A header with title and AI attribution
  - Tags (e.g., STRATEGY, INSIGHTS)
  - A brief narrative text
  - A highlights section with key metrics or points
  - A "Read Full Summary" action

#### Scenario: Full content expansion
- **WHEN** the user selects "Read Full Summary"
- **THEN** the card expands or opens a modal to show the complete detailed summary

### Requirement: Inspiration Dock Visibility Control
The system MUST allow users to toggle the visibility of the Inspiration Dock.

#### Scenario: Closing the Dock
- **WHEN** the user clicks the "Close" (X) button on the Inspiration Dock
- **THEN** the Inspiration Dock disappears from the view
- **AND** a "Sparkles" icon/toggle becomes available/highlighted in the toolbar

#### Scenario: Re-opening the Dock
- **WHEN** the Inspiration Dock is hidden
- **AND** the user clicks the "Sparkles" toggle in the toolbar
- **THEN** the Inspiration Dock reappears in the center of the screen

### Requirement: Studio Layout
The Studio SHALL provide a workspace centered around an infinite whiteboard canvas.

#### Scenario: Default layout
- **WHEN** a user opens a project
- **THEN** they see the whiteboard canvas occupying the majority of the screen
- **AND** a resource sidebar on the left
- **AND** floating controls for chat and navigation overlaid on the canvas.

### Requirement: Resource Management
The Studio SHALL provide a dedicated sidebar for managing project resources.

#### Scenario: File upload
- **WHEN** a user drags a file onto the "Drop files here" zone in the sidebar
- **THEN** the file is uploaded and added to the resource list.

### Requirement: Canvas Interaction
The Studio SHALL provide high-performance canvas interactions.

#### Scenario: Navigation
- **WHEN** a user interacts with the floating navigation controls
- **THEN** the canvas zooms or pans accordingly with smooth transitions.

### Requirement: Floating Chat Interface
The Studio SHALL provide a floating chat interface for AI assistance.

#### Scenario: Chat interaction
- **WHEN** a user types in the bottom-center chat bar
- **THEN** the message is sent to the AI and the response is displayed contextually.

### Requirement: Inspiration Dock Mind Map Action
The Inspiration Dock SHALL offer a mechanism to trigger mind map generation.

#### Scenario: Mind Map button availability
- **WHEN** one or more documents are selected in the sidebar
- **THEN** the Inspiration Dock displays a "Generate Mind Map" option/icon

### Requirement: Mind Map Card Display
The system SHALL display the generated mind map in a minimized card format.

#### Scenario: Mind Map presentation
- **WHEN** the mind map generation starts
- **THEN** a Mind Map Card appears in the workspace/dock
- **AND** nodes appear incrementally ("grow") as they are generated
- **AND** the card shows a simplified or zoomed-out view of the structure

#### Scenario: Full Mind Map expansion
- **WHEN** the user interacts with the Mind Map Card (e.g., clicks expand button)
- **THEN** the mind map opens in a full view (modal or maximized state)
- **AND** the user can pan and zoom to explore details

### Requirement: Mind Map Real-time Rendering
The system SHALL render mind map nodes in real-time as they are generated by the backend.

#### Scenario: Node growth animation
- **WHEN** a new node is received from the backend stream
- **THEN** it appears on the canvas with an animation (e.g., fading in or growing from parent)
- **AND** it is automatically connected to its parent node

### Requirement: Mind Map Layout Selection
The system SHALL provide multiple layout options for organizing mind map nodes visually.

#### Scenario: Switch to radial layout
- **WHEN** a user selects "Radial" from the layout options
- **THEN** nodes are arranged in a circular pattern around the root node
- **AND** child nodes fan out in concentric circles based on depth
- **AND** edges curve smoothly to connect nodes

#### Scenario: Switch to tree layout
- **WHEN** a user selects "Tree" from the layout options
- **THEN** nodes are arranged in a hierarchical top-down or left-right structure
- **AND** sibling nodes are aligned on the same level
- **AND** edges connect parent to children in straight or orthogonal lines

#### Scenario: Switch to balanced layout
- **WHEN** a user selects "Balanced" from the layout options
- **THEN** child nodes are distributed evenly on both sides of the root
- **AND** the layout minimizes visual clutter and crossing edges

#### Scenario: Preserve custom positions after layout change
- **WHEN** a user switches layout
- **AND** then manually drags nodes to custom positions
- **THEN** the custom positions are preserved until another layout is applied

### Requirement: Mind Map Interactive Canvas
The Mind Map full view SHALL provide an interactive canvas where users can reorganize the layout.

#### Scenario: Drag node to reposition
- **WHEN** a user drags a node in the full view
- **THEN** the node moves to the new position
- **AND** connected edges update to follow the node
- **AND** the layout change is preserved in the current session

#### Scenario: Pan and zoom canvas
- **WHEN** a user scrolls the mouse wheel on the canvas
- **THEN** the view zooms in or out centered on the cursor
- **WHEN** a user drags on the canvas background
- **THEN** the view pans in the drag direction

### Requirement: Mind Map Node Editing
The system SHALL allow users to manually add, delete, and edit nodes after generation.

#### Scenario: Add new node
- **WHEN** a user clicks the "Add Node" action
- **AND** selects a parent node
- **AND** enters a label for the new node
- **THEN** a new node appears as a child of the selected parent
- **AND** an edge connects the new node to its parent

#### Scenario: Delete node
- **WHEN** a user selects a node
- **AND** clicks the "Delete" action
- **THEN** the node is removed from the mindmap
- **AND** all child nodes and their edges are also removed
- **AND** edges connected to the deleted node are removed

#### Scenario: Edit node label
- **WHEN** a user double-clicks a node label
- **THEN** the label becomes editable inline
- **WHEN** the user confirms the edit (Enter or click outside)
- **THEN** the label is updated

### Requirement: Mind Map Export
The system SHALL allow users to download the mindmap in common formats.

#### Scenario: Export as image
- **WHEN** a user clicks the "Download" button
- **AND** selects "PNG" format
- **THEN** the current mindmap is exported as a PNG image
- **AND** the browser initiates a download with filename based on the mindmap title

#### Scenario: Export as data
- **WHEN** a user clicks the "Download" button
- **AND** selects "JSON" format
- **THEN** the current mindmap data (nodes, edges, positions) is exported as JSON
- **AND** the browser initiates a download with `.json` extension

### Requirement: Mind Map Performance Optimization
The system SHALL maintain smooth performance when handling large mindmaps with many nodes.

#### Scenario: Viewport culling for off-screen nodes
- **WHEN** a mindmap contains more than 50 nodes
- **THEN** only nodes within or near the visible viewport are fully rendered
- **AND** nodes far outside the viewport are skipped or rendered as simplified shapes
- **AND** the frame rate remains above 30fps during pan and zoom

#### Scenario: Level of detail rendering
- **WHEN** the user zooms out to view many nodes at once
- **THEN** node details (content text, icons) are hidden progressively
- **AND** only labels are shown at medium zoom levels
- **AND** nodes become simple shapes at far zoom levels
- **AND** edges are simplified to straight lines at far zoom levels

#### Scenario: Throttled drag updates
- **WHEN** a user drags a node
- **THEN** position updates are throttled to 60fps maximum
- **AND** edge recalculations are debounced during active drag
- **AND** full edge redraw only occurs on drag end

#### Scenario: Layout calculation offloading
- **WHEN** a layout algorithm is applied to a large mindmap (>100 nodes)
- **THEN** the calculation runs asynchronously without blocking the UI
- **AND** a loading indicator is shown during calculation
- **AND** the UI remains responsive to cancel or other actions

#### Scenario: Batch rendering for streaming nodes
- **WHEN** new nodes are generated during AI streaming
- **THEN** nodes are batched and rendered in groups (e.g., every 100ms)
- **AND** individual node additions do not trigger full re-renders
- **AND** React reconciliation is optimized using stable keys

#### Scenario: Memory cleanup on unmount
- **WHEN** the mindmap view is closed or unmounted
- **THEN** all Konva objects and event listeners are properly disposed
- **AND** no memory leaks occur from repeated open/close cycles
- **AND** large node content is released from memory

#### Scenario: Performance warning for very large mindmaps
- **WHEN** a mindmap exceeds 200 nodes
- **THEN** a subtle warning indicator is shown
- **AND** the user is offered options to collapse branches or limit visible depth
- **AND** the system suggests exporting before adding more nodes

### Requirement: Icon Abstraction Layer
The frontend SHALL provide a centralized icon abstraction layer to decouple components from specific icon library implementations.

#### Scenario: Centralized icon exports
- **WHEN** a component needs to use an icon
- **THEN** it SHALL import from `@/components/ui/icons`
- **AND** SHALL NOT import directly from any icon library (e.g., `lucide-react`, `@mui/icons-material`)

#### Scenario: Consistent icon props interface
- **WHEN** an icon is rendered
- **THEN** it SHALL accept a standard `IconProps` interface
- **AND** `size` SHALL accept semantic values ('xs', 'sm', 'md', 'lg', 'xl') or pixel numbers
- **AND** `color` SHALL accept semantic values ('primary', 'secondary', 'error', etc.)

#### Scenario: Design system swap
- **WHEN** the underlying icon library needs to change
- **THEN** only the `components/ui/icons/` folder needs modification
- **AND** consuming components SHALL NOT require changes

### Requirement: MUI Icon Implementation
The icon abstraction layer SHALL use `@mui/icons-material` as the underlying implementation.

#### Scenario: Icon theming
- **WHEN** an icon is rendered
- **THEN** it SHALL respect MUI theme colors
- **AND** SHALL integrate with MUI's `SvgIcon` system

#### Scenario: Tree-shaking support
- **WHEN** the application is built
- **THEN** only used icons SHALL be included in the bundle
- **AND** unused icons SHALL be eliminated by tree-shaking

