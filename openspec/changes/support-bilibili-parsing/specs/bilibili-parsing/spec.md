# Spec: Bilibili Parsing

## ADDED Requirements

### Requirement: Extract Timestamped Subtitles
The extractor MUST extract subtitles from Bilibili videos and format them with `[TIME:MM:SS]` markers at the beginning of each segment (or periodically).

#### Scenario: Video has subtitles
- **Given** a Bilibili URL `https://www.bilibili.com/video/BV1xx411c7mD` that has user-contributed subtitles (CC).
- **When** the `BilibiliExtractor` processes this URL.
- **Then** the returned content should contain the subtitle text.
- **And** the content should contain `[TIME:MM:SS]` markers (e.g., `[TIME:00:15]`).

### Requirement: Audio Transcription Fallback
When a Bilibili video lacks subtitles, the system MUST attempt to download the audio and transcribe it using Gemini.

#### Scenario: Video has no subtitles
- **Given** a Bilibili URL `https://www.bilibili.com/video/BV1xx411c7mD` that has **no** subtitles.
- **And** a valid OpenRouter API key is configured.
- **When** the `BilibiliExtractor` processes this URL.
- **Then** it should trigger the fallback mechanism.
- **And** `GeminiAudioTranscriber` should be called with the Bilibili URL.
- **And** the result should be a transcript with `[TIME:MM:SS]` markers generated by Gemini.

### Requirement: Platform Agnostic Transcription
The transcription service MUST support any video URL supported by `yt-dlp`, not just YouTube.

#### Scenario: Transcribing Bilibili Audio
- **Given** the `GeminiAudioTranscriber`.
- **When** `transcribe_video` is called with a Bilibili URL.
- **Then** it should successfully download audio using `yt-dlp`.
- **And** send it to Gemini for transcription.
